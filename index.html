<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒ»ãƒ¡ãƒ¢ Pro</title>
    <style>
        body { font-family: -apple-system, sans-serif; background: #f0f2f5; display: flex; flex-direction: column; align-items: center; padding: 20px; margin: 0; }
        .card { background: white; padding: 25px; border-radius: 24px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); width: 100%; max-width: 400px; box-sizing: border-box; }
        h2 { text-align: center; color: #007aff; margin-bottom: 20px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; font-size: 14px; color: #555; }
        input, textarea, button { width: 100%; margin-bottom: 15px; padding: 12px; border: 1px solid #ddd; border-radius: 12px; box-sizing: border-box; font-size: 16px; -webkit-appearance: none; }
        input[type="date"], input[type="time"] { font-size: 18px; font-weight: bold; text-align: center; }
        button { background: #007aff; color: white; border: none; font-weight: bold; cursor: pointer; padding: 16px; font-size: 18px; }
        button:active { transform: scale(0.98); background: #0056b3; }
        .status-msg { text-align: center; font-size: 12px; color: #888; }
    </style>
</head>
<body>

    <div class="card">
        <h2>ğŸ“… ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ç™»éŒ²</h2>
        
        <label>æ—¥ä»˜</label>
        <input type="date" id="eventDate">
        
        <label>æ™‚åˆ»</label>
        <input type="time" id="eventTime">
        
        <label>ãƒ¡ãƒ¢ï¼ˆã‚¿ã‚¤ãƒˆãƒ«ï¼‰</label>
        <textarea id="eventMemo" placeholder="ä½•ã‚’ã™ã‚‹äºˆå®šï¼Ÿ" rows="2"></textarea>
        
        <button id="submitBtn" onclick="registerAll()">ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã«ä¿å­˜</button>
        
        <p class="status-msg" id="statusMsg">æ—¥ä»˜ã¨æ™‚é–“ã¯ç¾åœ¨ã®ã‚‚ã®ãŒã‚»ãƒƒãƒˆã•ã‚Œã¦ã„ã¾ã™</p>
    </div>

    <script>
        // 1. ç”»é¢ã‚’é–‹ã„ãŸæ™‚ã«ã€Œä»Šæ—¥ã®æ—¥ä»˜ã€ã¨ã€Œç¾åœ¨ã®æ™‚åˆ»ã€ã‚’ã‚»ãƒƒãƒˆ
        window.onload = function() {
            const now = new Date();
            
            // æ—¥ä»˜ã‚’ YYYY-MM-DD å½¢å¼ã§ã‚»ãƒƒãƒˆ
            const y = now.getFullYear();
            const m = (now.getMonth() + 1).toString().padStart(2, '0');
            const d = now.getDate().toString().padStart(2, '0');
            document.getElementById('eventDate').value = `${y}-${m}-${d}`;
            
            // æ™‚åˆ»ã‚’ HH:mm å½¢å¼ã§ã‚»ãƒƒãƒˆ
            const hh = now.getHours().toString().padStart(2, '0');
            const mm = now.getMinutes().toString().padStart(2, '0');
            document.getElementById('eventTime').value = `${hh}:${mm}`;
        };

        async function registerAll() {
            const date = document.getElementById('eventDate').value;
            const time = document.getElementById('eventTime').value;
            const memo = document.getElementById('eventMemo').value || "ç„¡é¡Œã®äºˆå®š";
            const btn = document.getElementById('submitBtn');

            if (!date || !time) return alert("æ—¥æ™‚ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");

            // --- A. Googleã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã¸é€ä¿¡ (GAS) ---
            btn.disabled = true;
            btn.innerText = "ä¿å­˜ä¸­...";
            
            // â˜…ä»¥å‰ä½œæˆã—ãŸGASã®URLã‚’ã“ã“ã«è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„â˜…
            const gasUrl = "https://script.google.com/macros/s/AKfycbyyW7NJ8Uq1hkOxqL_koUhxI8CuIFJGEckTQ1VEsRIiXTBeEBaGT4rSsXNJoV21q_0/exec";

            try {
                if(gasUrl.includes("http")) {
                    await fetch(gasUrl, {
                        method: "POST",
                        mode: "no-cors",
                        body: JSON.stringify({ date, time, memo })
                    });
                }

                // --- B. åŒæ™‚ã«iPhoneã®æ¨™æº–ã‚¢ãƒ©ãƒ¼ãƒ ã‚‚èµ·å‹•ã•ã›ã‚‹ ---
                // æ—¥ä»˜ãŒã€Œä»Šæ—¥ã€ã®å ´åˆã®ã¿ã‚¢ãƒ©ãƒ¼ãƒ ã‚’é£›ã°ã™è¨­å®šã«ã™ã‚‹ã¨ã‚ˆã‚Šä¾¿åˆ©ã§ã™
                const shortcutUrl = "shortcuts://run-shortcut?name=MakeAlarm&input=" + encodeURIComponent(time);
                window.location.href = shortcutUrl;

                alert("ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã«äºˆç´„ã—ã¾ã—ãŸï¼");
                document.getElementById('eventMemo').value = "";
            } catch (e) {
                alert("é€ä¿¡ã‚¨ãƒ©ãƒ¼ã€‚URLã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚");
            } finally {
                btn.disabled = false;
                btn.innerText = "ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã«ä¿å­˜";
            }
        }
    </script>
</body>
</html>
